---
- hosts: all
  become: yes
  vars_files:
  - env_variables 
  tasks:

  - name: install APT Transport HTTPS
    apt:
      name: apt-transport-https
      state: present
 
  - name: add Kubernetes apt-key
    apt_key:
      url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
      state: present

  - name: add Kubernetes apt repository
    apt_repository:
      repo: deb http://apt.kubernetes.io/ kubernetes-xenial main
      state: present
      filename: 'kubernetes'

  - name: Adding repository details in Kubernetes repo file.
    blockinfile:
     path: /etc/apt/sources.list.d/kubernetes.list
     block: deb https://apt.kubernetes.io/ kubernetes-xenial main

  - name: Installing required packages
    apt:
     name: "{{ packages }}"
     state: present
    with_items: "{{ packages }}"

  - name: Starting and Enabling the required services
    service:
     name: "{{ item }}"
     state: started
     enabled: yes
    with_items: "{{ services }}"


